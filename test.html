<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test - PNW Ford Lead Performance</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            max-width: 800px;
            margin: 0 auto;
        }
        .test-section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .pass {
            color: green;
        }
        .fail {
            color: red;
        }
        pre {
            background: #f5f5f5;
            padding: 10px;
            border-radius: 3px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <h1>Security & Functionality Test</h1>
    
    <div class="test-section">
        <h2>1. XSS Test</h2>
        <p>Testing HTML escape function with malicious input:</p>
        <pre id="xss-test"></pre>
        <div id="xss-result"></div>
    </div>
    
    <div class="test-section">
        <h2>2. File Validation Test</h2>
        <p>Testing file type validation:</p>
        <div id="file-test"></div>
    </div>
    
    <div class="test-section">
        <h2>3. Input Validation Test</h2>
        <p>Testing numeric input validation:</p>
        <div id="input-test"></div>
    </div>
    
    <div class="test-section">
        <h2>4. Division by Zero Test</h2>
        <p>Testing calculation with zero values:</p>
        <div id="calc-test"></div>
    </div>

    <script>
        // Load the app.js to test functions
        const script = document.createElement('script');
        script.src = 'app.js';
        script.onload = runTests;
        document.head.appendChild(script);
        
        function runTests() {
            // Test 1: XSS Prevention
            const maliciousInput = '<script>alert("XSS")</script>';
            const escaped = escapeHtml(maliciousInput);
            document.getElementById('xss-test').textContent = `Input: ${maliciousInput}\nEscaped: ${escaped}`;
            document.getElementById('xss-result').innerHTML = escaped; // Safe to use innerHTML with escaped content
            document.getElementById('xss-result').innerHTML += '<p class="pass">✓ XSS test passed - script tags are escaped</p>';
            
            // Test 2: File Validation
            const fileTest = document.getElementById('file-test');
            const testFiles = [
                { name: 'test.csv', size: 1000, expected: 'pass' },
                { name: 'test.xlsx', size: 1000, expected: 'pass' },
                { name: 'test.exe', size: 1000, expected: 'fail' },
                { name: 'huge.csv', size: 20 * 1024 * 1024, expected: 'fail' }
            ];
            
            fileTest.innerHTML = '<ul>';
            testFiles.forEach(file => {
                const result = validateFile(file);
                fileTest.innerHTML += `<li class="${result === file.expected ? 'pass' : 'fail'}">
                    ${file.name} (${file.size} bytes): ${result === file.expected ? '✓' : '✗'} ${file.expected}
                </li>`;
            });
            fileTest.innerHTML += '</ul>';
            
            // Test 3: Input Validation
            const inputTest = document.getElementById('input-test');
            const testInputs = [
                { value: -10, expected: 0 },
                { value: 150, expected: 100 },
                { value: 50, expected: 50 },
                { value: 'abc', expected: 0 }
            ];
            
            inputTest.innerHTML = '<ul>';
            testInputs.forEach(test => {
                const result = Math.max(0, Math.min(100, parseFloat(test.value) || 0));
                inputTest.innerHTML += `<li class="${result === test.expected ? 'pass' : 'fail'}">
                    Input: ${test.value}, Expected: ${test.expected}, Got: ${result} ${result === test.expected ? '✓' : '✗'}
                </li>`;
            });
            inputTest.innerHTML += '</ul>';
            
            // Test 4: Division by Zero
            const calcTest = document.getElementById('calc-test');
            const zeroLeads = 0;
            const zeroDivision = zeroLeads > 0 ? (10 / zeroLeads * 100).toFixed(2) : '0.00';
            calcTest.innerHTML = `<p class="pass">✓ Division by zero handled: ${zeroDivision}</p>`;
        }
        
        // Helper function to validate files (simplified version)
        function validateFile(file) {
            const allowedTypes = ['.csv', '.xlsx', '.xls'];
            const fileName = file.name.toLowerCase();
            const fileExt = fileName.substring(fileName.lastIndexOf('.'));
            const maxSize = 10 * 1024 * 1024;
            
            if (!allowedTypes.includes(fileExt)) {
                return 'fail';
            }
            if (file.size > maxSize) {
                return 'fail';
            }
            return 'pass';
        }
    </script>
</body>
</html>